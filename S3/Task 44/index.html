<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task 44</title>

    <link rel="stylesheet" href="style.css">
    <script src="js/main.js"></script>

    <style>
        body,
        html{
            padding: 0;
            margin: 0;
            height: 100%;
            background-color: #fff;
        }

        #wrap {
            width: 100%;
            margin: 0 auto;
            margin-top: 20px;
            min-height: 100%;
        }

        #add {
            border: none;
            background-color: #2ecc71;
            border-radius: 3px;
            outline: none;
            padding: .4rem 1rem;
            margin-left: .6rem;
            font-size: 1rem;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            font-family: 'Open Sans', Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", SimSun, Heiti, sans-serif;
            -webkit-appearance: none;
        }
        #add:hover {
            background-color: #58d68d;
        }
        #add:active {
            background-color: #27ad60;
            color: #ccc;
        }
        .loading {
            position: relative;
            height: 500px;
        }
        .loading:before {
            content: '';
            position: absolute;
            width: 2rem;
            height: 2rem;
            background-color: #1D9027;
            left: calc(50% - 1rem);
            top: calc(50% - 1rem);
            animation: loading 1s cubic-bezier(0.59, 0.02, 0.3, 1) infinite;
        }
        @keyframes loading {
            0% {
                border-radius: 0;
                background-color: #ccc;
                transform: rotate(0deg); }
            50% {
                border-radius: 50%;
                background-color: #4eba56;
                transform: rotate(180deg); }
            100% {
                border-radius: 1%;
                background-color: #ccc;
                transform: rotate(359deg); }
        }
    </style>

</head>
<body>

    <div id="wrap">
        <div class="loading"></div>
    </div>

    <div style="text-align: center;margin: 20% 0 5% 0">
        <input type="button" id="add" value="添加图片">
    </div>
<script>

    new Promise(function(resolve, reject) {

        var xhr = new XMLHttpRequest();

        xhr.open('get', 'http://geeku.work/ife/api/img.php', true);

        xhr.send(null);

        xhr.onreadystatechange = function() {
            if(xhr.readyState === 4) {
                if(xhr.status == 200) {
                    resolve(xhr.responseText);
                } else {
                    reject();
                }
            }
        }

    }).then(function(val) {

        /*document.querySelector('.loading').remove();*/

        var wow = wowPhoto({
            wrap: '#wrap',
            col: 6
        })

        var imgList = JSON.parse(val);

        imgList.forEach(function (item) {
            wow.add(item);
        })

    });

    /*var wow = wowPhoto({
        wrap: '#wrap',
        col: 6
    });

    //模拟ajax
    document.querySelector('#add').addEventListener('click', function() {

        var addList = [];
        for(var i = 0; i < 10; i++) {

            var width = Math.random() * (600 - 300) + 300,
                height = Math.random() * (800 - 100) + 100;

            width = parseInt(width, 10);
            height = parseInt(height, 10);

            addList.push({
                'type': 'img',
                'width': width,
                'height': height,
                'src': 'http://placehold.it/' + width + 'x' + height,
                'title': 'Image Title Ajax',
                'content': 'Image Content Ajaxxxxxx'
            });
        }

        for (var item in addList) {
            console.log(addList[item]);
            wow.add(addList[item]);
        }
    });*/
</script>

</body>
</html>